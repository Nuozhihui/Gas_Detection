C51 COMPILER V9.60.0.0   MAIN                                                              04/11/2022 21:40:46 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\MAIN.obj
COMPILER INVOKED BY: D:\Code\ARM\C51\BIN\C51.EXE MAIN.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\HA;.\HA\DHT11;.\HA\LCD;.\HA\AD
                    -C;.\HA\STEP) DEBUG OBJECTEXTEND PRINT(.\Listings\MAIN.lst) TABS(2) OBJECT(.\Objects\MAIN.obj)

line level    source

   1          
   2          #include "lcd.h"
   3          #include<intrins.h>
   4          #include<stdio.h>
   5          #include "DHT11.h"
   6          #include "Gas.h"
   7          #include "STEP.h"
   8          
   9          #define AD_CH0 0x94
  10          #define AD_CH1 0xd4
  11          #define AD_CH2 0xa4
  12          #define AD_CH3 0xe4 
  13          
  14          
  15          sbit KEY1=P3^2;
  16          sbit KEY2=P3^3; 
  17          sbit LED1=P1^7;
  18          sbit BEEP=P2^3;
  19          sbit Relay=P2^2;
  20          //----------------DHT11数据变量区-------------------------------
  21          unsigned int rec_dat[4];
  22          unsigned char rec_dat_lcd0[6];
  23          unsigned char rec_dat_lcd1[6];
  24          unsigned char rec_dat_lcd2[6];
  25          unsigned char rec_dat_lcd3[6];
  26          
  27          unsigned char switch_f=0;
  28          unsigned char key_switch_f=0;
  29          
  30          void gx_date(void);   //更新数据
  31          
  32          void delay1(unsigned int z)
  33          {
  34   1        unsigned int x,y;
  35   1        for(x=z;x>0;x--)
  36   1          for(y=120;y>0;y--);
  37   1      }
  38          
  39          
  40          
  41          
  42          
  43          void KEY_CL()
  44          {
  45   1        if(key_switch_f ==1)
  46   1        {
  47   2          if(switch_f==0)
  48   2        {
  49   3        //开
  50   3        LED1=1;
  51   3        
  52   3      
  53   3          Go_Step();
*** WARNING C206 IN LINE 53 OF MAIN.c: 'Go_Step': missing function-prototype
C51 COMPILER V9.60.0.0   MAIN                                                              04/11/2022 21:40:46 PAGE 2   

  54   3          
  55   3           Relay=1;
  56   3            delay1(1000);
  57   3          delay1(1000);
  58   3          delay1(1000);
  59   3          delay1(1000);
  60   3          delay1(1000);
  61   3           Relay=0;
  62   3          
  63   3          switch_f=1;
  64   3          
  65   3          key_switch_f=0;
  66   3          
  67   3      
  68   3        
  69   3        
  70   3      
  71   3          
  72   3        }
  73   2      }
  74   1        
  75   1        if(key_switch_f ==2)
  76   1        {
  77   2          if(switch_f==1)
  78   2      {
  79   3        //关
  80   3        LED1=0;
  81   3        
  82   3        
  83   3        //关
  84   3        LED1=0;
  85   3        
  86   3          Break_Step();
*** WARNING C206 IN LINE 86 OF MAIN.c: 'Break_Step': missing function-prototype
  87   3          Relay=1;
  88   3          delay1(1000);
  89   3          delay1(1000);
  90   3          delay1(1000);
  91   3          delay1(1000);
  92   3          delay1(1000);
  93   3          Relay=0;
  94   3          switch_f=0;
  95   3          while(!KEY2);
  96   3        
  97   3        
  98   3        
  99   3      }
 100   2          
 101   2        }
 102   1        
 103   1      }
 104          
 105          
 106          
 107          
 108          void IINT_INT()
 109          {
 110   1          IT1 = 1;                        //set INT1 int type (1:Falling only 0:Low level)
 111   1          EX1 = 1;                        //enable INT1 interrupt
 112   1      
 113   1          IT0 = 1;                        //set INT0 int type (1:Falling 0:Low level)
 114   1          EX0 = 1;                        //enable INT0 interrupt
C51 COMPILER V9.60.0.0   MAIN                                                              04/11/2022 21:40:46 PAGE 3   

 115   1          EA = 1;                         //open global interrupt switch
 116   1        
 117   1        
 118   1      }
 119          uint voltage;//电压值
 120          //主函数
 121          void main()
 122          {
 123   1        
 124   1      
 125   1        InitLcd1602();            //初始化LCD
 126   1        LcdShowStr(0,0,"GAS:"); //更新画面
 127   1        
 128   1        LcdShowStr(0,1,"Temp:");  //更新画面
 129   1        
 130   1        P1=0xf1;
 131   1      
 132   1        KEY1=1;
 133   1        KEY2=1;
 134   1        Relay=0;
 135   1        IINT_INT();
 136   1        while(1)
 137   1        {
 138   2          gx_date();
 139   2          KEY_CL();
 140   2          
 141   2          
 142   2      
 143   2        }
 144   1        
 145   1        
 146   1      }
 147          
 148          
 149          
 150          
 151          //MQ 和 DHT11 数据更新
 152          void gx_date()
 153          {
 154   1          DHT11_delay_ms(20);
 155   1          DHT11_receive();
 156   1      
 157   1          voltage = ReadAD(AD_CH3); //通道0光敏cmd：0x94  通道1热敏cmd：0xd4  通道2电位器cmd：0xa4 通道3外部输入AI
             -N3 cmd：0xe4
 158   1          voltage = (voltage * 1.2207) /10; //  （5/4096）
 159   1          
 160   1        
 161   1        
 162   1          //空气
 163   1          sprintf(rec_dat_lcd0,"%d",voltage);
 164   1      
 165   1          DHT11_delay_ms(13);
 166   1          LcdShowStr(6,0,rec_dat_lcd0);
 167   1      
 168   1      
 169   1        
 170   1          //温度
 171   1          sprintf(rec_dat_lcd2,"%d",rec_dat[0]);
 172   1          sprintf(rec_dat_lcd3,"%d",rec_dat[1]);
 173   1          DHT11_delay_ms(13);
 174   1          
 175   1      
C51 COMPILER V9.60.0.0   MAIN                                                              04/11/2022 21:40:46 PAGE 4   

 176   1      
 177   1          LcdShowStr(6,1,rec_dat_lcd2);
 178   1          LcdShowStr(8,1,".");
 179   1          LcdShowStr(9,1,rec_dat_lcd3);
 180   1          LcdShowStr(10,1," %");
 181   1      
 182   1          
 183   1          if(voltage>150 || rec_dat[0]>80)
 184   1          {
 185   2             key_switch_f=2;
 186   2            BEEP=0;
 187   2            
 188   2          }else{
 189   2            
 190   2            BEEP=1;
 191   2          }
 192   1          
 193   1        
 194   1      }
 195          void exint0() interrupt 0           //(location at 0003H)
 196          {
 197   1          key_switch_f=1;
 198   1      }
 199          
 200          //External interrupt1 service routine
 201          void exint1() interrupt 2           //(location at 0013H)
 202          {
 203   1          key_switch_f=2;
 204   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    424    ----
   CONSTANT SIZE    =     19    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     36    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
