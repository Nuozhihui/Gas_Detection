C51 COMPILER V9.60.0.0   DHT11                                                             05/02/2022 18:41:53 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\Objects\DHT11.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE Library\DHT11\DHT11.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Library\ADC;.\Libra
                    -ry\DHT11;.\Library\LCD;.\Library\STEP;.\Library\Show;.\Library\KEY) DEBUG OBJECTEXTEND PRINT(.\Listings\DHT11.lst) TABS(
                    -2) OBJECT(.\Objects\DHT11.obj)

line level    source

   1          #include<reg51.h>
   2          #include<intrins.h>
   3          #include<stdio.h>
   4          #include<lcd.h>
   5          #include "DHT11.h"
   6          
   7          
   8          
   9          //----------------DHT11数据变量区-------------------------------
  10          unsigned int rec_dat[4];
  11          unsigned char rec_dat_lcd0[6];
  12          unsigned char rec_dat_lcd1[6];
  13          unsigned char rec_dat_lcd2[6];
  14          unsigned char rec_dat_lcd3[6];
  15          
  16          //DHT11起始信号
  17          
  18          void DHT11_start()  
  19          {
  20   1        Temp_data=1;
  21   1        
  22   1        DHT11_delay_us(2);
  23   1        
  24   1        Temp_data=0;
  25   1        
  26   1        DHT11_delay_ms(20);
  27   1        
  28   1        Temp_data=1;
  29   1        
  30   1        DHT11_delay_us(13);
  31   1        
  32   1      
  33   1      }
  34          
  35          //接收一个字节
  36          
  37          
  38          unsigned char DHT11_rec_byte()
  39          {
  40   1        
  41   1        unsigned char i,dat;
  42   1      
  43   1        
  44   1        for(i=0;i<8;i++)
  45   1        {
  46   2            while(!Temp_data);
  47   2            DHT11_delay_us(8);
  48   2            dat<<=1;
  49   2            if(Temp_data==1)
  50   2            {
  51   3              dat+=1;
  52   3            }
  53   2            while(Temp_data);
C51 COMPILER V9.60.0.0   DHT11                                                             05/02/2022 18:41:53 PAGE 2   

  54   2        }
  55   1      
  56   1        return dat;
  57   1      
  58   1        
  59   1      }
  60          
  61          
  62          //接收温湿度数据
  63          void DHT11_receive()
  64          {
  65   1        
  66   1        unsigned int R_H,R_L,T_H,T_L;
  67   1        unsigned char RH,RL,TH,TL,revise;
  68   1      
  69   1        DHT11_start();
  70   1        Temp_data=1;
  71   1        if(Temp_data==0)
  72   1        {
  73   2          while(Temp_data==0);   //等待拉高     
  74   2              DHT11_delay_us(40);  //拉高后延时80us
  75   2          
  76   2              R_H=DHT11_rec_byte();    //接收湿度高八位  
  77   2              R_L=DHT11_rec_byte();    //接收湿度低八位  
  78   2              T_H=DHT11_rec_byte();    //接收温度高八位  
  79   2              T_L=DHT11_rec_byte();    //接收温度低八位
  80   2              revise=DHT11_rec_byte(); //接收校正位
  81   2      
  82   2              DHT11_delay_us(25);    //结束
  83   2      
  84   2              if((R_H+R_L+T_H+T_L)==revise)      //校正
  85   2              {
  86   3                  RH=R_H;
  87   3                  RL=R_L;
  88   3                  TH=T_H;
  89   3                  TL=T_L;
  90   3        
  91   3              } 
  92   2            
  93   2              rec_dat[0]=RH;
  94   2              rec_dat[1]=RL;
  95   2      //        rec_dat[2]=TH;
  96   2      //        rec_dat[3]=TL;
  97   2      
  98   2        }
  99   1        
 100   1      }
 101          
 102          //延时us   --2*n+5us
 103          void DHT11_delay_us(unsigned char n)
 104          {
 105   1          while(--n);
 106   1      }
 107          
 108          //延时ms
 109          void DHT11_delay_ms(unsigned int z)
 110          {
 111   1         unsigned int i,j;
 112   1         for(i=z;i>0;i--)
 113   1            for(j=110;j>0;j--);
 114   1      }
 115          
C51 COMPILER V9.60.0.0   DHT11                                                             05/02/2022 18:41:53 PAGE 3   

 116          
 117          //DHT11 数据更新
 118          void gx_date()
 119          {
 120   1          DHT11_delay_ms(20);
 121   1          DHT11_receive();
 122   1      
 123   1      
 124   1          //温度
 125   1          sprintf(rec_dat_lcd0,"%d",rec_dat[0]);
 126   1          sprintf(rec_dat_lcd1,"%d",rec_dat[1]);
 127   1          DHT11_delay_ms(13);
 128   1          
 129   1          LcdShowStr(6,1,rec_dat_lcd0);
 130   1          LcdShowStr(8,1,".");
 131   1          LcdShowStr(9,1,rec_dat_lcd1);
 132   1          LcdShowStr(10,1," %");
 133   1          
 134   1        
 135   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    335    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
